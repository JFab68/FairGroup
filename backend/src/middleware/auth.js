const db = require('../config/database');
exports.requireAuth = (req, res, next) => { if (!req.session?.memberId) return res.status(401).json({ error: 'Authentication required' }); next(); };
exports.requireRole = (...roles) => (req, res, next) => { if (!req.session || !roles.includes(req.session.role)) return res.status(403).json({ error: 'Insufficient permissions' }); next(); };
exports.requireSubcommitteeLeadership = async (req, res, next) => { if (req.session.role === 'admin') return next(); const { subcommitteeId } = req.params; const subcommittee = await db.query('SELECT chair_id, vice_chair_id FROM subcommittees WHERE id = ', [subcommitteeId]); if (!subcommittee.rows.length) return res.status(404).json({ error: 'Subcommittee not found' }); const { chair_id, vice_chair_id } = subcommittee.rows[0]; if (chair_id === req.session.memberId || vice_chair_id === req.session.memberId) return next(); return res.status(403).json({ error: 'Subcommittee leadership required' }); };
