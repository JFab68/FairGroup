import { createContext, useContext, useState, useEffect } from 'react'; import api from '../services/api'; const AuthContext = createContext(null); export const AuthProvider = ({ children }) => { const [member, setMember] = useState(null); const [loading, setLoading] = useState(true); useEffect(() => { api.get('/api/members/me').then(res => setMember(res.data)).catch(() => setMember(null)).finally(() => setLoading(false)); }, []); const login = async (email, password) => { const res = await api.post('/api/auth/login', { email, password }); setMember(res.data); return res.data; }; const logout = async () => { await api.post('/api/auth/logout'); setMember(null); }; const hasRole = (...roles) => member && roles.includes(member.role); return <AuthContext.Provider value={{ member, login, logout, hasRole, loading }}>{children}</AuthContext.Provider>; }; export const useAuth = () => useContext(AuthContext);
