import { useState } from 'react'; import { useQuery, useMutation, useQueryClient } from 'react-query'; import api from '../../services/api'; const AttendanceTaker = ({ eventId, subcommitteeId }) => { const queryClient = useQueryClient(); const [attendance, setAttendance] = useState({}); const { data: members } = useQuery(['subcommittee-members', subcommitteeId], () => api.get(`/api/subcommittees/${subcommitteeId}`).then(res => res.data.members)); const { data: existingAttendance } = useQuery(['attendance', eventId], () => api.get(`/api/attendance/${eventId}`).then(res => res.data)); const mutation = useMutation(({ memberId, status, notes }) => api.post(`/api/attendance/${eventId}`, { memberId, status, notes }), { onSuccess: () => queryClient.invalidateQueries(['attendance', eventId]) }); const handleStatusChange = (memberId, status) => { setAttendance(prev => ({ ...prev, [memberId]: status })); mutation.mutate({ memberId, status }); }; if (!members) return <div>Loading members...</div>; return (<div className='attendance-taker' style={{ marginTop: '2rem' }}><h3>Record Attendance</h3><table><thead><tr><th>Member</th><th>Status</th><th>Notes</th></tr></thead><tbody>{members.map(member => (<tr key={member.id}><td>{member.name}</td><td><select value={attendance[member.id] || existingAttendance?.find(a => a.member_id === member.id)?.status || ''} onChange={(e) => handleStatusChange(member.id, e.target.value)}><option value=''>Select</option><option value='Present'>Present</option><option value='Absent'>Absent</option><option value='Conflict'>Conflict</option></select></td><td><input type='text' placeholder='Optional notes' onBlur={(e) => mutation.mutate({ memberId: member.id, status: attendance[member.id], notes: e.target.value })} /></td></tr>))}</tbody></table></div>); }; export default AttendanceTaker;
